<!DOCTYPE html>
<html lang="en" class="no-js">

<head>
	<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Lock One Stop Shop</title>
	<meta name="description" content="Lock One Stop Shop; A Warlock resource for Sims and Guides" />
	<meta name="keywords" content="demonology, affliction, destruction, warlock, guides, simulationcraft, not, terryn" />
	<meta name="author" content="Not" />
	<link rel="shortcut icon" href="favicon.ico">
	<!-- demo styles -->
	<link rel="stylesheet" type="text/css" href="css/guide.css" />
	<!-- menu styles -->
	<link rel="stylesheet" type="text/css" href="css/component.css" />
	<script src="js/modernizr-custom.js"></script>
</head>

<body>
	<!-- Main container -->
	<div class="container">
		<!-- Blueprint header -->
		<header class="bp-header cf">
			<div class="dummy-logo">
				<img src="img/logo.png" alt="LOSS">
			</div>
		</header>
		<button class="action action--open" aria-label="Open Menu"><span class="icon icon--menu"></span></button>
		<nav id="ml-menu" class="menu">
			<button class="action action--close" aria-label="Close Menu"><span class="icon icon--cross"></span></button>
			<div class="menu__wrap">
				<ul data-menu="main" class="menu__level">
					<li class="menu__item"><a class="menu__link spec" data-submenu="affliction" href="#">Affliction</a></li>
					<li class="menu__item"><a class="menu__link spec" data-submenu="destruction" href="#">Destruction</a></li>
					<li class="menu__item"><a class="menu__link spec" data-submenu="demonology" href="#">Demonology</a></li>
				</ul>
				<!-- AFF Main menu -->
				<ul data-menu="affliction" class="menu__level">
					<li class="menu__item"><a class="menu__link" href="#">Introduction</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Talents</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Mechanics</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Gearing</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Stats</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Artifact</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Rotation</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Glyphs</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Macros</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Addons</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Changelog</a></li>
					<li class="menu__item"><a class="menu__link sims" data-submenu="affliction-sims-1" href="#">Sims</a></li>
				</ul>
				<!-- AFF Sims Menu -->
				<ul data-menu="affliction-sims-1" class="menu__level">
					<li class="menu__item"><a class="menu__link" href="#">Talent</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Trinket</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Relic</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Legendary</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Misc</a></li>
				</ul>
				<!-- DESTRO Main Menu -->
				<ul data-menu="destruction" class="menu__level">
					<li class="menu__item"><a class="menu__link" href="#">Introduction</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Talents</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Mechanics</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Gearing</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Stats</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Artifact</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Rotation</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Glyphs</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Macros</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Addons</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Changelog</a></li>
					<li class="menu__item"><a class="menu__link sims" data-submenu="destruction-sims-1" href="#">Sims</a></li>
				</ul>
				<!-- DESTRO Sims Menu -->
				<ul data-menu="destruction-sims-1" class="menu__level">
					<li class="menu__item"><a class="menu__link" href="#">Talent</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Trinket</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Relic</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Legendary</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Misc</a></li>
				</ul>
				<!-- DEMO Main Menu -->
				<ul data-menu="demonology" class="menu__level">
					<li class="menu__item"><a class="menu__link" href="#">Introduction</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Talents</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Mechanics</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Gearing</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Stats</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Artifact</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Rotation</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Glyphs</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Macros</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Addons</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Changelog</a></li>
					<li class="menu__item"><a class="menu__link sims" data-submenu="demo-1" href="#">Sims</a></li>
				</ul>
				<!-- DEMO Trink Menu -->
				<ul data-menu="demo-1" class="menu__level">
					<li class="menu__item"><a class="menu__link" href="#">Talent</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Trinket</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Relic</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Legendary</a></li>
					<li class="menu__item"><a class="menu__link" href="#">Misc</a></li>
				</ul>
			</div>
		</nav>
		<div class="content">
			<p class="info">Please choose a spec</p>
			<!-- Ajax loaded content here -->
		</div>
	</div>
	<!-- /view -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<script src="https://static-azeroth.cursecdn.com/current/js/syndication/tt.js"></script>
	<script src="js/classie.js"></script>
	<script src="js/xbbcode.js"></script>
	<script src="js/mmochampbb.js"></script>
	<script src="js/main.js"></script>
	<script>
		(function () {
			var menuEl = document.getElementById('ml-menu'),
				mlmenu = new MLMenu(menuEl, {
					// breadcrumbsCtrl : true, // show breadcrumbs
					initialBreadcrumb: 'Specs', // initial breadcrumb text
					backCtrl: false, // show back button
					// itemsDelayInterval : 60, // delay between each menu item sliding animation
					onItemClick: getPageData // callback: item that doesnÂ´t have a submenu gets clicked - onItemClick([event], [inner HTML of the clicked item])
				});

			// mobile menu toggle
			var openMenuCtrl = document.querySelector('.action--open'),
				closeMenuCtrl = document.querySelector('.action--close');

			openMenuCtrl.addEventListener('click', openMenu);
			closeMenuCtrl.addEventListener('click', closeMenu);

			function openMenu() {
				classie.add(menuEl, 'menu--open');
			}

			function closeMenu() {
				classie.remove(menuEl, 'menu--open');
			}

			$(".spec").on("click", function () {
				window.spec = $(this).text();
			});

			// simulate grid content loading
			var gridWrapper = document.querySelector('.content');
			$("a.menu__link").removeClass("menu__link--current");

			// if url filled get pageData
			var urlLocation = window.location.hash.substring(1).split("/");
			window.spec = urlLocation[1] || "";
			var itemName = urlLocation[2] || "";
			
			if(itemName == 'Sims'){
				$("a:contains('"+window.spec+"')")[0].click();
				gridWrapper.innerHTML = '';
				classie.add(gridWrapper, 'content--loading');
				setTimeout(function () {
					$(".menu__level--current li a:contains('Sims')")[0].click();
					setTimeout(function () {
						$(".menu__level--current li a:contains('"+urlLocation[urlLocation.length-1]+"')")[0].click();
					}, 2000);
				}, 2000);
			}else if(window.spec == "" && itemName == ""){
				// do nothing
			}else{	
				$("a:contains('"+window.spec+"')")[0].click();
				$("a:contains('"+itemName+"')").addClass("menu__link--current");
				getPageData("", itemName);
			}
			

			function getPageData(ev, itemName) {
				if(ev.preventDefault)ev.preventDefault();

				closeMenu();
				gridWrapper.innerHTML = '';
				classie.add(gridWrapper, 'content--loading');

				var guide;
				var request = new XMLHttpRequest();
				if($("nav a:nth-child(3)")[0] !== undefined && $("nav a:nth-child(3)")[0].text === "Sims"){
					request.open('GET', 'guides/' + window.spec + '/Sims/'+itemName+'.html?_='+new Date().getTime(), true);
					console.log('itemName:', 'guides/' + window.spec + '/Sims/'+itemName+'.html?_='+new Date().getTime());
					window.location.hash = "/"+window.spec+"/Sims/"+itemName;
				} else {
					request.open('GET', 'guides/' + window.spec + '/'+itemName+'.html?_='+new Date().getTime(), true);
					console.log('itemName:', 'guides/' + window.spec + '/'+itemName+'.html?_='+new Date().getTime());
					window.location.hash = "/"+window.spec+"/"+itemName;
				}

				// window.history.replaceState({}, "LOSS", url);
				// window.location.hash = "/"+url;

				url = ""
				
				request.onload = function () {
					if (request.status >= 200 && request.status < 400) {
						guide = request.responseText;
						parseBb()
					} else {
						guide = 'Loading Error try again';
					}
				};

				request.onerror = function (e) {
					// There was a connection error of some sort
				};

				request.send();

				function parseBb() {
					var convertedBBtoHtml = XBBCODE.process({
						text: guide,
						removeMisalignedTags: false,
						addInLineBreaks: true
					});


					// add to html
					// guideHtmlTag.innerHTML = convertedBBtoHtml.html;
					setTimeout(function () {
						classie.remove(gridWrapper, 'content--loading');
						gridWrapper.innerHTML = '<div class="guides hidden">' + convertedBBtoHtml.html + "</div>";
						setTimeout(function () {
							$(".guides").removeClass("hidden");
							resetWowDB()
						}, 500);
						//Expand and collapse
						$(".ExpandBtn").on('click', function () {

							if ($(this).text() == 'Expand') {
								$(this).next().animate({
									height: '100%'
								});
								$(this).text('Colapse');
							} else {
								$(this).next().animate({
									height: 10
								});
								$(this).text('Expand');
							}

							return false;
						});

					}, 1500);

				}

				function resetWowDB(){
					var __tip=new CurseTip({Url:"http://www.wowdb.com",Namespace:"wowdb-tooltip",Paths:["achievements","currencies","items","npcs","pet-abilities","quests","spells","wod-talents","world-events","garrison/abilities","garrison/buildings","garrison/followers","garrison/missions","garrison/ships","orderhall/talents",],Arguments:["gems","itemLevel","enchantment","reforge","extragem","upgradeNum","setPieces","bonusIDs"],LoadingText:'<div class="wowdb-tooltip"><div class="db-tooltip"><div class="db-description" style="width: auto">Loading..</div></div></div>',});function WP_Stretch(a){var b=600;a.find(".db-description").each(function(){var e=jQuery(this);var c=e.width();var d=false;e.find(".tooltip-table tr, .db-title, h2, h3, .db-achievement-criteria > li").each(function(){var f=parseInt(jQuery(this).attr("data-height"),10)||25;while(jQuery(this).height()>f&&c<b){d=true;c+=10;e.width(c)}});if(d){e.width(c+20)}})}if(typeof Azeroth!=="undefined"){Azeroth.CurseTip=__tip};
				}
			}
		})();
	</script>
</body>

</html>